<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Google Maps JavaScript API v3 Example: Geocoding Simple</title>
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD9ay2njITLpb8SD2l5lAH7O4eQeY8F8w0&sensor=false"></script>
    <script>
      var geocoder;
      var map;
      function initialize() {
        geocoder = new google.maps.Geocoder();
        var latlng = new google.maps.LatLng(-34.397, 150.644);
        var mapOptions = {
          zoom: 12,
          center: latlng,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
        pageLoaded()
      }


      function codeAddress() {
        var address = document.getElementById('address').value;
        geocoder.geocode( { 'address': address}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            map.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location
            });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }

    function pageLoaded() { 
            var qAt = document.URL.indexOf("?"); 
            var params = document.URL.substr(qAt+1); 
            // Use params as needed (parse, or pass along to flash swf): 
            alert(params);  // just echoing in this example. 
            document.getElementById('address').value = params;
            codeAddress();
        } 

    function pageLoaded() { 
            var qAt = document.URL.indexOf("?"); 
            var params = document.URL.substr(qAt+1);    
            // Use params as needed (parse, or pass along to flash swf): 
            //alert(params);  // just echoing in this example. 
            document.getElementById('address').value = params.split('%20').join(' ');
            codeAddress();
        } 

    function get_coords() {
            pos = map.getCenter();
            document.getElementById('lat').value = pos;
            value = document.getElementById('lat').value;
            ndx = value.indexOf(",")
            //alert(ndx);
            var posx = value.substr(1, ndx - 1)
            var posy = value.substr(ndx+1, value.length - ndx -2)
            document.getElementById('lat').value = posx 
            document.getElementById('lng').value = posy

/*
            var res = window.opener.document.getElementsByTagName("input"); // get element by tag name
            alert(res.length);
            var j =""
            var k =""
            for(i=0; i < res.length; i++) {
                if (res[i].type == 'text') {
                    alert("name: " + res[i].name + "\nid:" + res[i].id+ "\ntype:" + res[i].type+ "\nstyle:" + res[i].style)                    
                }
                if (res[i].name =="latitude") {
                    j = res[i].id
                }
                if (res[i].name =="longitude") {
                    k = res[i].id
                }
                
            }

            window.opener.document.getElementById(j).focus();
            var xinput = window.opener.document.getElementById(j).value = posx;
            window.opener.document.getElementById(j).blur()
*/
            window.opener.document.getElementById("oe-field-input-53").active = true;
            window.opener.document.getElementById("oe-field-input-53").focus();
            alert("Dando focus...")
            var xinput = window.opener.document.getElementById("oe-field-input-53").value = posx;
            alert("Cambiando valor...")
            window.opener.document.getElementById("oe-field-input-53").blur()
//            window.opener.document.getElementById("oe-field-input-53").active = true;
            alert("Saliendo del focus...")
            window.close();

        } 


    </script>
  </head>
  <body onload="initialize()">
    <div>
      <input id="address" type="textbox" value="Sydney, NSW">
      <input type="button" value="Geocode" onclick="codeAddress()">
      <input type="button" value="Get Coords" onclick="get_coords()">
      <input id="lat" type="textbox" >
      <input id="lng" type="textbox" >
    </div>
    <div id="map_canvas" style="height:90%;top:30px"></div>
  </body>
</html>
